<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1, user-scalable=no">
    <title>向商家付款</title>
    <style>
        * {
            -webkit-touch-callout:none;
            /*-webkit-user-select:none;*/
            -khtml-user-select:none;
            -moz-user-select:none;
            -ms-user-select:none;
            user-select:none;
            margin:0;padding:0;
        }
        body{font-family:'微软雅黑';font-size:12px;background-color: #fff}
        a{text-decoration:none;}
        li{list-style:none;}
        body,html{width:100%;height:auto;}
        .clear{clear:both;overflow:hidden;}
        .cleat{width:100%;position:fixed;bottom:0;left:0;margin-bottom: 0;}
        .cleat table{background:#f6f6f6;border-collapse: collapse;width:100%;border-bottom:solid 1px #ccc;margin-bottom: 0}
        @font-face{	font-family: "fzzdxjw";    src: url("__TMPL__Public/pay/ttf/fzzdxjw.ttf")	}
        .cleat table td{border-top:solid 1px #ccc;border-left:solid 1px #ccc;width:25%;text-align:center;color:#323232;padding:3.5% 0;font-size: 25px;}
        .cleat table td img{display:block;width:40%;margin:0 auto;}
        .cleat table tr td:nth-child(1){border-left:none;}
        .cleat table tr td.tbgds{background:#8fbc8f;color:#fff;}
        .newconte{position:relative;width:96%;margin:4% auto 0 auto;}
        .newry label{margin-top:2%;color:#b6b6b6;font-size:15px;display:block;line-height:10px;}
        .newry input{display:block;line-height:20px;border:none;color:#ccc;margin-left:2%;outline:none;font-size:28px;}
        .newconte{padding:4.5% 0 4% 0;background:url(__TMPL__Public/pay/images/newbavk.jpg) bottom center no-repeat;background-size:100%;border-bottom:none;}
        .newry input::-webkit-input-placeholder {color: #ccc;}
        .newry input:-moz-placeholder {color: #ccc;}
        .newry input::-moz-placeholder{color: #ccc;}
        .newry input:-ms-input-placeholder {color: #ccc;}
        .newry input{text-align:right;width:70%;float:right;color:#000;font-family:'微软雅黑';margin-bottom:4%;margin-top:4%;background:none;margin-right:2%;}
        .newry input:focus{color:#000000}
        .newry label{font-size:17px;color:#323232;margin-top:3%;}
        .newry{width:88%;margin:0 auto;}
        .tuos{width:88%;margin:3% auto 4% auto;}
        .tuos img{display:block;margin:0 auto;border-radius:52px;width:30px;float:left;}
        .tuos h4{display:block;text-align:center;color:#323232;font-size:17px;margin:1% 0 0 5px;font-weight:500;float:left;}
        .btnlogon{width:120px;margin:2% auto;display:block;}
        .btns{width:86%;margin:1% auto 0 auto;}
        .btns label,.btns font{display:inline-block;float:left;color:#939393;font-size:14px;}
        .btns font{float:left;}
        .tavkd{width:100%;height:100%;background:#000;opacity:0.3;z-index:99;display:block;position:fixed;top:0;left:0;}
        .youhui{width:76%;background:#fff;border-radius:12px;position:fixed;top:20%;left:12%;z-index:999;padding-bottom:6%;display:none;}
        .mima{width:86%;background:#fff;border-radius:12px;position:fixed;top:30%;left:7%;z-index:999;padding-bottom:6%;display:none;}
        .weload{width:14%;position:fixed;top:35%;left:43%;z-index:1000;display:none;}
        .mima h3{font-weight:200;color:#000;font-size:16px;width:100%;text-align:center;margin-top:7%;margin-bottom:6%;}
        /*.mima .cenmimi{width:90%;margin:0 auto;}*/
        /*.mima .cenmimi input{display:inline-block;  width:22px;height:22px;text-align:center;border-radius:2px;margin-left:5.5%;border:solid 1px #ccc;outline:none}*/
        .mima a{position:absolute;top:16%;right:5%;width:13px;}
        .mima a img{display:block;width:100%;}
        .youhui{width:76%;background:none;}
        .youyi{width:100%;background:#fff;border-radius:13px;}
        .youhui h3{text-align:center;display:block;color:#000;font-size:16px;margin:4% auto;font-weight:300;}
        .youhui ul{width:100%;margin:0 auto;}
        .youhui ul li{width:100%;clear:both;overflow:hidden;border-top:solid 1px #e6e6e6;padding:4% 0;}
        .youhui ul li span{display:inline-block;color:#323232;font-size:15px;margin-left:3%;float:left;line-height:17px;}
        .youhui ul li .disco{display:inline-block;float:right;line-height:17px;margin-right:3%;font-size:13px;}
        .youhui ul li .jifen{display:inline-block;float:right;line-height:17px;margin-right:3%;font-size:13px;}
        .youhui ul li .agent_disco{display:inline-block;float:right;line-height:17px;margin-right:3%;font-size:13px;}
        .youhui ul li .agent_jifen{display:inline-block;float:right;line-height:17px;margin-right:3%;font-size:13px;}
        .youhui ul li a{border:solid 1px #329cff;width:15px;height:15px;border-radius:15px;display:inline-block;float:right;margin-right:3%;}
        .youhui .nihk{width:30px;margin:7% auto 0 auto;display:block;}
        .youhui .nihk img{display:block;width:100%;}
        .on{background:#1080d8;background:url(__TMPL__Public/pay/images/closk.png) center center no-repeat;background-size:10px;}
        .neti{width:90%;margin:2% auto;}
        .neti .youhuijin span,.neti a{display:none;color:#939393;font-size:14px;float:left;}
        .neti a{margin-left:2%;color:#329cff}
        .neti .yingf{color:#ee4c4c;font-size:14px;float:right;}
        .neti .yingf:before{content:'应付金额:';color:#939393;font-size:14px;}
        #tankd{display: none}
        @media (min-width:350px) and (max-width:430px){
            .newry{margin-top:3%;}
        }
        input{     color:transparent;margin-left: 110%; }
        .alieditContainer{position:relative;}
        .alieditContainer .i-text{position: absolute;color: #fff;opacity:0.2; width:306px; height:48px; font-size:12px; left:0; -webkit-user-select:initial;  /*取消禁用选择页面元素*/z-index:9;	padding:0;	borde:0;}
        .alieditContainer .sixDigitPassword {margin: auto;width:306px; height:22px; cursor:text; background:#fff; outline:none; position:relative; padding:13px 0; border:1px solid #ddd; border-radius:5px;}
        .alieditContainer .sixDigitPassword i {width:50px; height:16px; float:left; display:block; padding:4px 0; border-left:1px solid #cccccc;}
        .alieditContainer .sixDigitPassword i:first-child{border-left:0;}
        .alieditContainer .sixDigitPassword i.active{background-image: url("https://t.alipayobjects.com/images/rmsweb/T1nYJhXalXXXXXXXXX.gif");background-repeat: no-repeat;background-position: center center; }
        .alieditContainer .sixDigitPassword b{display:block; margin:5px auto 4px auto; width:7px; height:7px; overflow:hidden; display:none;/*visibility:hidden;*/ background:#000; border-radius:100%;}
        .alieditContainer .sixDigitPassword .guangbiao{width:50px; height:48px; position:absolute; display:block; left:0px; top:-1px; border:1px solid rgba(82, 168, 236, .8); border:1px solid #00ffff\9; border-radius:5px; visibility:visible; -webkit-box-shadow: inset 0px 2px 2px rgba(0, 0, 0, 0.75), 0 0 8px rgba(82, 168, 236, 0.6); box-shadow: inset 0 1px 1px rgba(0, 0, 0, 0.075), 0 0 8px rgba(82, 168, 236, 0.6);}
        /*.newcontebz{margin:0 auto 0 auto;width:94%;padding:8% 0 4%;background:url(__TMPL__Public/pay/images/bgbeiz.png) bottom center no-repeat;background-size:100%;border-bottom:none;}*/
        /*.newcontebz input{text-align:right;width:70%;float:right;color:#000;font-family:'微软雅黑';margin-bottom:4%;margin-top:4%;background:none;margin-right:2%;}*/

        .beizhu{margin:0 auto 0 auto;width:94%;height:56px;background:url(__TMPL__Public/pay/images/bgbeiz1.png) bottom center no-repeat;background-size:100%;}
        .beizhu label{color:#000;font-size:15px;display:inline-block;float:left;margin-left:4.5%;line-height:40px;}
        .beizhu input{font-size:15px;float:left;line-height:40px;border:none;color:#000;margin-left:4%;outline:none;width: 80%;background-color: transparent}
        .beizhu label,.beizhu input{padding:2% 0;}
    </style>
</head>
<body>
<div class="tuos clear"><img src="__TMPL__Public/pay/images/homeixonwx.png"/><h4>{$merchant['jianchen']}</h4></div>
<div class="newconte clear">
    <div class="newry clear"><label>消费金额(元)</label>
        <input placeholder="0" type="text" id="ontgj" readonly='readonly'></div>
    <div class="btns clear">
        <if condition="isset($agent_yue) && ($agent_yue nheq '')">
            <label class="yue">可用储值:{$agent_yue|floatval}</label>
            <elseif condition="isset($yue) && ($yue nheq '')"/>
            <label class="yue">可用储值:{$yue|floatval}</label>
            <else/>
            <label class="yue">　</label>
        </if>
    </div>
</div>
<div class="neti clear">
    <span class="youhuijin"><span>优惠金额:￥0 </span><a onclick="displa()">点击查看</a></span><span class="yingf">￥0</span>
</div>
<div class="beizhu clear ">
    <label>备注:</label>
    <input name="memo" type="text" placeholder="可输入财务系统订单号或其他描述">
</div>
<div class="cleat clear">
    <img src="__TMPL__Public/pay/images/bickv.jpg" class="btnlogon"/>
    <table id="tabw">
        <tr>
            <td class="lxl" ontouchend="pay_money(this,1)">1</td>
            <td class="lxl" ontouchend="pay_money(this,1)">2</td>
            <td class="lxl" ontouchend="pay_money(this,1)">3</td>
            <td class="lxl" ontouchend="pay_money(this,3)"><img src="__TMPL__Public/pay/images/delect.png"/></td>
        </tr>
        <tr>
            <td class="lxl" ontouchend="pay_money(this,1)">4</td>
            <td class="lxl" ontouchend="pay_money(this,1)">5</td>
            <td class="lxl" ontouchend="pay_money(this,1)">6</td>
            <td class="tbgds" id="btnw" style="font-family:'微软雅黑';" rowspan=3 >支付</td>
        </tr>
        <tr>
            <td class="lxl" ontouchend="pay_money(this,1)">7</td>
            <td class="lxl" ontouchend="pay_money(this,1)">8</td>
            <td class="lxl" ontouchend="pay_money(this,1)">9</td>
        </tr>
        <tr>
            <td class="lxl" ontouchend="pay_money(this,1)" colspan=2>0</td>
            <td class="lxl" ontouchend="pay_money(this,1)">.</td>
        </tr>
    </table>
</div>

<div class="mima" id="mima">
    <h3>请输入余额支付密码</h3><a onClick="document.getElementById('mima').style.display='none';document.getElementById('tankd').style.display='none'"><img
        src="__TMPL__Public/pay/images/close.jpg"/></a>
    <div class="alieditContainer" id="payPassword_container">
        <input minlength="6" maxlength="6" tabindex="1" id="payPassword_rsainput" oninput="yuepay(this)" name="payPassword_rsainput" class="ui-input i-text" oncontextmenu="return false" onpaste="return false" oncopy="return false" oncut="return false" autocomplete="off" value=""  readonlyunselectable="on"  type="number">
        <div class="sixDigitPassword" tabindex="0">
            <i class="active"><b></b></i>
            <i><b></b></i>
            <i><b></b></i>
            <i><b></b></i>
            <i><b></b></i>
            <i><b></b></i>
            <span class="guangbiao" style="left:0px;"></span>
        </div>
    </div>
</div>
<div class="youhui" id="youhui">
    <div class="youyi clear">
        <h3>选择优惠</h3>
        <ul id="ulul">
            <!--联名卡-->
            <if condition="!empty($agent_discount)">
                <li class="discount agent">
                    <span>代理联名卡{$agent_discount}折</span>
                    <a></a>
                    <span class="agent_disco">-￥0</span>
                </li>
            </if>
            <if condition="$agent_credits neq 0">
                <li class="dikoujf agent">
                    <span>--积分抵扣</span>
                    <a></a>
                    <span class="agent_jifen">-￥0</span>
                </li>
            </if>
            <!--会员卡-->
            <if condition="!empty($discount)">
                <li class="discount mch">
                    <span>商家会员卡{$discount}折</span>
                    <a></a>
                    <span class="disco">-￥0</span>
                </li>
            </if>
            <if condition="$credits neq 0">
                <li class="dikoujf mch">
                    <span>--积分抵扣</span>
                    <a></a>
                    <span class="jifen">-￥0</span>
                </li>
            </if>
            <if condition="!empty($coupon_data)">
                <volist  name="coupon_data" id="v">
                    <li man="{$v.total_price}" jian="{$v.de_price}" code="{$v.usercard}" class="coupon">
                        <span>满{$v.total_price}减{$v.de_price}优惠券</span>
                        <a></a>
                    </li>
                </volist>
            </if>
        </ul>
    </div>
    <a class="nihk" onClick="document.getElementById('youhui').style.display='none';document.getElementById('tankd').style.display='none'"><img
            src="__TMPL__Public/pay/images/closeing.png"/></a>
</div>

<input type="hidden" name="seller_id" value="{$seller_id}">
<input type="hidden" name="openid" value="{$openid}">
<input type="hidden" name="checker_id" value="{$checker_id}">
<input type="hidden" name="agent_yue" value="{$agent_yue|0}">
<input type="hidden" name="mch_yue" value="{$yue|0}">
<div class="tavkd clear" id="tankd"></div>
<img class="weload" src="__TMPL__Public/pay/images/wenewload.gif" alt="">
<script src="__TMPL__Public/pay/news/js/jquery.min.js"></script>
<!--<script src="__TMPL__Public/pay/news/js/bootstrap.min.js"></script>-->
<script>
    var flag = {$flag};
    var mch_id ={$merchant.merchant_id|default=0};
</script>
<script>
    $(function () {
        if(flag){
            // 显示优惠信息
            $(".youhuijin span").show();
            $(".neti a").show();
            //        计算折扣优惠 默认选择代理折扣
            if($(".discount a.on").length == 0 && $(".dikoujf a.on").length == 0){
                $(".discount a").eq(0).addClass("on");
                var clsName = $(".discount").eq(0).attr("class");
                if(clsName == 'discount agent'){
                    if($(".dikoujf.agent a").length){
                        $(".dikoujf.agent a").addClass("on");
                    }
                }
                if(clsName == 'discount mch') {
                    if($(".dikoujf.mch a").length){
                        $(".dikoujf.mch a").addClass("on");
                    }
                }
            }
        }
    });
    var ab =0;
    var agent_card_code ={$agent_card_code|default=0};  // 联名卡卡号
    var agent_yue = {$agent_yue|default=0};             // 联名卡余额
    var agent_discount = {$agent_discount|default=10};  // 联名卡折扣
    var agent_integral = {$agent_credits|default=0};    // 联名卡可用积分
    var agent_integral_use = {$agent_credits_use|default=0};            // 联名卡积分使用
    var agent_integral_discount = {$agent_credits_discount|default=0};  // 联名卡积分使用抵扣金额

    var mch_card_code ={$card_code|default=0};      // 商户卡卡号
    var mch_yue = {$yue|default=0};                 // 商户卡余额
    var mch_discount = {$discount|default=10};      // 商户卡折扣
    var mch_integral = {$credits|default=0};        // 商户卡可用积分
    var mch_integral_use = {$credits_use|default=0};            // 商户积分使用
    var mch_integral_discount = {$credits_discount|default=0};  // 商户积分使用抵扣金额

    var input_price = 0 ;       //输入的金额
    var realprice = 0;          // 最终金额
    var discount_discount = 0;  // 打折优惠的价格
    var coupon_discount = 0;    // 优惠券优惠的价格
    var integral_discount = 0;  // 积分抵扣优惠的价格
    var total_discount = 0;     // 优惠的价格总额
    var pay_yue = 0;            // 支付的储值金额
    var card_code = 0;          // 使用的卡号
    var use_discount = 10;      // 使用的折扣
    var use_integral = 0;       // 使用的积分
    var coupon_code = 0;        // 使用的优惠券码
    function pay_money(obj,tip){
        if(tip==1){
            var num;    //点击按钮的值
            var con = $('#ontgj').val();
            num = con + $(obj).html();
            if(num !=''&& num.substr(0,1) == '.'){num="";}
            num = num.replace(/[^\d.]/g,"");  //清除“数字”和“.”以外的字符
            num = num.replace(/\.{2,}/g,"."); //只保留第一个. 清除多余的
            num = num.replace(".","$#$").replace(/\./g,"").replace("$#$",".");
            num = num.replace(/^(\-)*(\d+)\.(\d\d).*$/,'$1$2.$3');//只能输入两个小数
            // 此处控制的是如果没有小数点，首位不能为类似于 01、02的金额
            if(num.indexOf(".")< 0 && num !="") {
                if (num.substr(0, 1) == '0' && num.length == 2) {
                    num = num.substr(1, num.length);
                }
            }
            if(num<=99999.99 && num.toString().length<=8){
                if(num.indexOf(".")>0){
                    num = num.replace(/\b(0+)/gi,"0");
                    if(num.toString().split(".")[1].length<=2){
                        $('#ontgj').val(num);
                    } else {
                        num =  num.substr(0, num.length - 1);
                    }
                }else {
                    $('#ontgj').val(num);
                }

            } else {
                num =  num.substr(0, num.length - 1);
            }
            if(num>0){
                $("#btnw").css('background','#32cd32');
            }
        }else if(tip==2){
            $('#ontgj').val('');
        }else if(tip==3){
            var con = document.getElementById('ontgj').value;
            num = con.slice(0,-1);
            if(num < 0.01){
                $("#btnw").css('background','#8fbc8f');
            }
            $('#ontgj').val(num);
        }
        input_price = toDecimal(num);
        realprice = input_price
        if(flag){
            // 优惠顺序，折扣》优惠券》积分》余额-------------------------------------------------------------------------------
            // 计算优惠金额
            getRealPrice(1);
        }
        $('.yingf').html('￥'+realprice);
        event.preventDefault();
    }
    $("#ulul li").bind("click",function () {
        var cls_name = $(this).attr("class")
        var status = $(this).find("a").attr("class");
        if(status == "on") {
            // 取消优惠
            realprice = input_price
            $(this).find("a").removeClass()
            if(cls_name == "discount agent" || cls_name == "discount mch"){
                getRealPrice(1);
            }
            if(cls_name == "coupon"){
                getRealPrice(0);
            }
            if(cls_name == "dikoujf agent" || cls_name == "dikoujf mch"){
                getRealPrice(1);
            }
        } else {
            // 选择优惠
            realprice = input_price
            $(this).find("a").addClass("on")
            if(cls_name == "discount agent"){   // 联名卡折扣
                $(".mch a").removeClass();
            }
            if(cls_name == "discount mch"){     // 商户卡折扣
                $(".agent a").removeClass();
            }
            if(cls_name == "coupon"){           // 优惠券
                var man = $(this).attr("man");
                if(realprice < toDecimal(man)){
                    $(this).find("a").removeClass()
                }
            }
            if(cls_name == "dikoujf agent"){    // 联名卡积分
                $(".mch a").removeClass();
            }
            if(cls_name == "dikoujf mch"){      // 商户卡积分
                $(".agent a").removeClass();

            }
            getRealPrice(1);
        }
    });
    // 计算最终需要支付的金额  优惠顺序，折扣》优惠券》积分》余额
    function getRealPrice(coupon_flag) {
        var choose = '';
        // 计算折扣价格
        discount_discount = 0;
        if($(".discount a.on").length == 1){
            var clsName = $(".discount a.on").parents("li").attr("class");
            if(clsName == 'discount agent'){
                choose = 'agent';
                discount_discount = toDecimal((10-agent_discount)/10 * realprice);
                realprice = toDecimal(realprice-discount_discount);
                $(".agent_disco").html("-￥"+discount_discount);
            }
            if(clsName == 'discount mch') {
                choose = 'mch';
                discount_discount = toDecimal((10-mch_discount)/10 * realprice);
                realprice = toDecimal(realprice-discount_discount);
                $(".disco").html("-￥"+discount_discount);
            }
        };

        // 计算优惠券使用
        coupon_discount = 0;
        coupon_code = 0;
        if(coupon_flag){
            if($('.coupon').length > 0 && $(".coupon a.on").length == 0){
                // 循环优惠券是否满足条件
                $('.coupon').each(function () {
                    var man = $(this).attr("man");
                    if(realprice >= parseFloat(man)){
                        $(".coupon a").attr("class", "");   // 取消所有优惠券
                        coupon_discount = toDecimal($(this).attr("jian"));
                        $(this).find('a').attr("class",'on');
                        realprice = toDecimal(realprice - coupon_discount);
                        coupon_code = $(this).attr("code");
                    }
                });
            } else if($(".coupon a.on").length == 1){
                var coupon = $(".coupon a.on").parents("li");
                var man = toDecimal(coupon.attr("man"));
                if(realprice >= parseFloat(man)){
                    var jian = toDecimal(coupon.attr("jian"));
                    coupon_discount = jian;
                    realprice = toDecimal(realprice - coupon_discount);
                    coupon_code = $(this).attr("code");
                } else {
                    $(".coupon a.on").attr("class", "") // 取消所有优惠券
                }
            }
        }

        // 计算积分抵扣金额
        integral_discount = 0;
        use_integral = 0;
        if($(".dikoujf a.on").length == 1){
            var clsName = $(".dikoujf a.on").parents("li").attr("class");
            var times = 0;
            var use_times = 0;
            if(clsName == 'dikoujf agent'){
                choose = 'agent';
                times = Math.floor(agent_integral/agent_integral_use);              // 最多使用积分的次数
                use_times = Math.floor(realprice/agent_integral_discount);          // 本次使用积分的次数
                if(use_times >= times){
                    use_times = times;
                }
                integral_discount = toDecimal(agent_integral_discount * use_times); // 抵扣的优惠
                realprice = toDecimal(realprice - integral_discount);               // 支付金额
                $(".agent_jifen").html("-￥"+integral_discount);
                use_integral = use_times*agent_integral_use;
            }
            if(clsName == 'dikoujf mch') {
                choose = 'mch';
                times = Math.floor(mch_integral/mch_integral_use);
                use_times = Math.floor(realprice/mch_integral_discount);           // 本次使用积分的次数
                if(use_times >= times){
                    use_times = times;
                }
                integral_discount = toDecimal(mch_integral_discount * use_times);
                realprice = toDecimal(realprice - integral_discount);
                $(".jifen").html("-￥"+integral_discount);
                use_integral = use_times*mch_integral_use;
            }
        };
        console.log(use_integral);
        // 使用会员卡储值
        var use_yue = 0;
        pay_yue = 0;
        if(choose == 'agent'){
            use_yue = agent_yue;
            card_code = agent_card_code;
            use_discount = agent_discount;
        } else if(choose == 'mch'){
            use_yue = mch_yue;
            card_code = mch_card_code;
            use_discount = mch_discount;
        }
        $('.yue').html("可用储值:"+use_yue);
        if((use_yue-realprice)>=0){
            pay_yue = realprice
            realprice = 0
        } else {
            pay_yue = use_yue
            realprice = toDecimal(realprice-use_yue)
        }
        total_discount = toDecimal(discount_discount+coupon_discount+integral_discount);
        $('.youhuijin span').html('优惠金额:￥'+total_discount);
        $('.yingf').html('￥'+realprice);
    }

    $('.tbgds').on('click', function () {
        var total = $("#ontgj").val();
        total = parseFloat(total);
        if(realprice == 0 && total != 0 && !isNaN(total)){
            $('.mima').css('display', 'block');
            $(".ui-input").val("").focus();
            $("#tankd").show();
        } else {
            var random=Math.ceil(Math.random()*100000);
            var id = $("input[name=seller_id]").val();
            var openid = $("input[name=openid]").val();
            var checker_id = $("input[name=checker_id]").val();
            var memo = $("input[name=memo]").val();
            if(realprice>0){
                if(ab<1) {
                    ab+=1;
                    // 表示使用优惠+微信支付
                    if(input_price > realprice){
                        $.ajax({
                            type: 'POST',
                            url: "https://sy.youngport.com.cn/index.php?s=/Pay/Barcode/cate_order",
                            data: {
                                order_amount:realprice,
                                dikoufen:use_integral,
                                dikoujin:integral_discount,
                                coupon_price:coupon_discount,
                                total_amount:input_price,
                                yue:pay_yue,
                                discount:use_discount,
                                order_benefit:total_discount,
                                coupon_code:coupon_code,
                                card_code:card_code,
                                mch_id:mch_id,
                            },
                            success: function (data) {
                                if(data.code == 'success'){
                                    var order_id = data.data;
                                    var price = realprice+"/id/"+ id+"/order_id/"+ order_id+"/mode/0/openid/"+openid+"/checker_id/"+checker_id+"/random/"+random+"/memo/"+memo+"/ok";
                                    location = "https://sy.youngport.com.cn/index.php?s=/Pay/Barcodepfbank/two_wz_pay/price/" + price;
                                } else {
                                    alert(data.msg)
                                }
                            },
                            error:function () {
                                alert('system error!')
                            },
                            dataType:"json"
                        });
                    } else{
                        var price = parseFloat(realprice)+"/seller_id/"+ id + "/openid/"+openid+"/checker_id/"+checker_id+"/random/"+random+"/memo/"+memo+"/ok";
                        location = "https://sy.youngport.com.cn/index.php?s=/Pay/Barcodembank/wz_pay/price/" + price;
                    }
                }
            }
        }
    })
</script>
<script>
    function displa() {
        $(".youhui").show();
        $("#tankd").show();
    }

    // 使用会员卡储值支付，使用用户设置的支付密码
    // 不调起微信支付，ajax请求支付
    function yuepay(obj) {
        var pass = $(obj).val()
        if(pass.length == 6){
            $('.weload').css('display', 'block');
            $('.mima').css('display', 'none');
            $(".ui-input").blur();
            var total = $("#ontgj").val();
            var id = $("input[name=seller_id]").val();
            var openid = $("input[name=openid]").val();
            var checker_id = $("input[name=checker_id]").val();
            var memo = $("input[name=memo]").val();
            console.log(checker_id);
//            console.log({
//                order_amount:0,
//                dikoufen:use_integral,
//                pass:pass,
//                cate_id:id,
//                openid:openid,
//                dikoujin:integral_discount,
//                coupon_price:coupon_discount,
//                total_amount:input_price,
//                yue:pay_yue,
//                discount:use_discount,
//                order_benefit:total_discount,
//                coupon_code:coupon_code,
//                card_code:card_code,
//                mch_id:mch_id,
//                memo:memo
//            })
            $.ajax({
                type: 'POST',
                url: "https://sy.youngport.com.cn/index.php?s=/Pay/Barcode/yue_pay",
                data: {
                    order_amount:0,
                    dikoufen:use_integral,
                    pass:pass,
                    cate_id:id,
                    openid:openid,
                    dikoujin:integral_discount,
                    coupon_price:coupon_discount,
                    total_amount:input_price,
                    yue:pay_yue,
                    discount:use_discount,
                    order_benefit:total_discount,
                    coupon_code:coupon_code,
                    card_code:card_code,
                    mch_id:mch_id,
                    checker_id:checker_id,
                    memo:memo
                },
                success: function (data) {
                    if(data.code == 'success'){
                        var order_id = data.data;
                        $('.weload').css('display', 'none');
                        location.href = "https://sy.youngport.com.cn/index.php?s=/Pay/Barcode/weixipay_return111/price/" +total+ '/openid/' + openid+'/order_id/' + order_id+'/mid/' + mch_id;
                    } else {
                        alert(data.msg)
                        $('.weload').css('display', 'none');
                        $("#tankd").hide();
                    }
                },
                error:function () {
                    alert('system error!')
                },
                dataType:"json"
            });
        }
    }
    //功能：将浮点数四舍五入，取小数点后2位
    function toDecimal(x) {
        var f = parseFloat(x);
        if (isNaN(f)) {
            return x;
        }
        f = Math.round(x*100)/100;
        return f;
    }

    $('.lxl').on('touchend',function(){$(this).css('background', '#f6f6f6')})
    $('.lxl').on('touchmove',function(){$(this).css('background', '#f6f6f6')})
    $('.lxl').on('touchstart',function(){$(this).css('background', '#999999')})
    $(window).ready(function() {

        $(".i-text").keyup(function()
        {
            var inp_v = $(this).val();
            var inp_l = inp_v.length;
            //$("p").html( "input的值为：" + inp_v +"; " + "值的长度为:" + inp_l);//测试用

            for( var x = 0; x<=6; x++)
            {
                $("p").html( inp_l );//测试

                $(".sixDigitPassword").find("i").eq( inp_l ).addClass("active").siblings("i").removeClass("active");
                $(".sixDigitPassword").find("i").eq( inp_l ).prevAll("i").find("b").css({"display":"block"});
                $(".sixDigitPassword").find("i").eq( inp_l - 1 ).nextAll("i").find("b").css({"display":"none"});

                $(".guangbiao").css({"left":inp_l * 51});//光标位置

                if( inp_l == 0)
                {
                    $(".sixDigitPassword").find("i").eq( 0 ).addClass("active").siblings("i").removeClass("active");
                    $(".sixDigitPassword").find("b").css({"display":"none"});
                    $(".guangbiao").css({"left":0});
                }
                else if( inp_l == 6)
                {
                    $(".sixDigitPassword").find("b").css({"display":"block"});
                    $(".sixDigitPassword").find("i").eq(5).addClass("active").siblings("i").removeClass("active");
                    $(".guangbiao").css({"left":5 * 51});
                }


            }
        });

    });
    $("input[name=memo]").focus(function () {
            $('.cleat').css('position','relative')
        }
    );
    $("input[name=memo]").blur(function () {
        $('.cleat').css('position','fixed')
    });

    window.addEventListener("popstate", function(e) {
        WeixinJSBridge.call('closeWindow');//根据自己的需求实现自己的功能
    }, false);
    pushHistory();
    function pushHistory() {
        var state = {
            title: "title",
            url: "#"
        };
        window.history.pushState(state, "title", "#");
    }
</script>
</body>
</html>
